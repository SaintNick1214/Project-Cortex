---
id: configuration
title: Configuration
sidebar_position: 5
description: Configure Cortex for development, staging, and production environments
---

# Configuration

Cortex uses a hierarchical configuration system managed by the CLI. Configuration is minimal by default but offers extensive customization when needed.

---

## Quick: Auth Integration

<Callout type="info" title="Common Question">
  "How do I integrate my auth system (Auth0, Clerk, Okta, WorkOS, etc.)?"
</Callout>

**Answer:** Cortex works with **ANY auth system** - just extract `userId` and optionally `tenantId`:

```typescript
import { createAuthContext } from "@cortexmemory/sdk";

// Extract from YOUR auth (3 lines of code)
const auth = createAuthContext({
  userId: yourAuthData.id, // Required
  tenantId: yourAuthData.tenantId, // Optional (multi-tenant SaaS)
});

// Pass to Cortex
const cortex = new Cortex({ convexUrl: process.env.CONVEX_URL!, auth });

// Done! All operations now authenticated
```

**Works with:** Auth0, Clerk, NextAuth, Supabase, Firebase, Okta, WorkOS, OIDC, OAuth, custom JWT, sessions, API keys, or any auth system you already use.

**See:** [Authentication Guide](/core-features/authentication) for complete setup.

---

## Configuration Hierarchy

The CLI uses a hierarchical configuration system (highest priority first):

1. **CLI Flags** - `--url`, `--key`, `--deployment`
2. **Environment Variables** - `CONVEX_URL`, `CONVEX_DEPLOY_KEY`
3. **Project Config** - `./cortex.config.json` (optional)
4. **User Config** - `~/.cortexrc` (managed by CLI)

### Example: How Priority Works

```bash
# User config (~/.cortexrc) says: local deployment
# Environment variable says: CONVEX_URL=http://127.0.0.1:3210
# CLI flag overrides everything:
cortex db stats --url https://prod.convex.cloud

# Result: Uses production URL from flag
```

---

## User Configuration (~/.cortexrc)

The CLI automatically manages `~/.cortexrc` for deployment settings.

### Viewing Configuration

<Terminal>cortex config show</Terminal>

```bash
# List all deployments
cortex config list

# View config file path
cortex config path
```

### Configuration File Format

The `~/.cortexrc` file is JSON:

```json
{
  "deployments": {
    "local": {
      "url": "http://127.0.0.1:3210",
      "deployment": "anonymous:anonymous-cortex-sdk-local",
      "projectPath": "/Users/you/projects/my-agent",
      "enabled": true
    },
    "staging": {
      "url": "https://staging.convex.cloud",
      "key": "dev:staging|key",
      "projectPath": "/Users/you/projects/my-agent",
      "enabled": false
    },
    "production": {
      "url": "https://prod.convex.cloud",
      "key": "prod:prod|key",
      "projectPath": "/Users/you/projects/my-agent",
      "enabled": false
    }
  },
  "apps": {
    "quickstart": {
      "type": "nextjs",
      "projectPath": "/Users/you/projects/my-agent",
      "path": "quickstart",
      "port": 3000,
      "startCommand": "npm run dev",
      "enabled": true
    }
  },
  "default": "local",
  "format": "table",
  "confirmDangerous": true
}
```

### Configuration Fields

<APITable parameters={[
  { name: "deployments", type: "object", required: true, description: "Named deployment configurations" },
  { name: "deployments[name].url", type: "string", required: true, description: "Convex deployment URL" },
  { name: "deployments[name].key", type: "string", required: false, description: "Deploy key (optional for local)" },
  { name: "deployments[name].deployment", type: "string", required: false, description: "Convex deployment name" },
  { name: "deployments[name].projectPath", type: "string", required: false, description: "Path to project directory" },
  { name: "deployments[name].enabled", type: "boolean", required: false, default: "false", description: "Auto-start with cortex start" },
  { name: "apps", type: "object", required: false, description: "Named app configurations" },
  { name: "apps[name].type", type: "string", required: false, description: "App type (e.g., 'nextjs')" },
  { name: "apps[name].port", type: "number", required: false, description: "Port number" },
  { name: "apps[name].startCommand", type: "string", required: false, description: "Command to start app" },
  { name: "default", type: "string", required: false, description: "Default deployment name" },
  { name: "format", type: "string", required: false, default: "table", description: "Default output format" },
  { name: "confirmDangerous", type: "boolean", required: false, default: "true", description: "Require confirmation for dangerous operations" },
]} />

---

## Managing Deployments

### Adding Deployments

<Steps>
  <Step title="Interactive mode (recommended)">

<Terminal>cortex config add-deployment</Terminal>

  </Step>
  <Step title="With options">

```bash
cortex config add-deployment cloud \
  --url https://your-app.convex.cloud \
  --key "prod|..."
```

  </Step>
  <Step title="Set as default">

```bash
cortex config add-deployment production \
  --url https://prod.convex.cloud \
  --default
```

  </Step>
</Steps>

### Removing Deployments

```bash
# Interactive mode
cortex config remove-deployment

# Specific deployment
cortex config remove-deployment staging
```

<Callout type="note">
  Cannot remove the default deployment. Set a different default first.
</Callout>

### Updating Deployment Settings

```bash
# Update URL
cortex config set-url production \
  --url https://new-prod.convex.cloud

# Update deploy key
cortex config set-key production \
  --key "prod|new-key"

# Set project path (enables running from anywhere)
cortex config set-path production /path/to/project
```

### Enabling/Disabling Deployments

Control which deployments start with `cortex start`:

```bash
# Enable (will auto-start)
cortex config enable staging

# Disable (won't auto-start)
cortex config disable production

# View status
cortex config list
```

### Switching Deployments

```bash
# Show current deployment
cortex use

# Switch to different deployment
cortex use production

# Clear current deployment
cortex use --clear

# All subsequent commands use the current deployment
cortex db stats  # Uses production (from 'cortex use production')
```

### Testing Configuration

<Terminal>cortex config test</Terminal>

```bash
# Test specific deployment
cortex config test --deployment production
```

---

## Environment Variables

### Convex Configuration

<APITable parameters={[
  { name: "CONVEX_URL", type: "string", required: true, description: "Convex deployment URL" },
  { name: "CONVEX_DEPLOY_KEY", type: "string", required: false, description: "Convex deploy key" },
  { name: "CONVEX_DEPLOYMENT", type: "string", required: false, description: "Convex deployment name" },
  { name: "LOCAL_CONVEX_URL", type: "string", required: false, default: "http://127.0.0.1:3210", description: "Local Convex URL" },
  { name: "CLOUD_CONVEX_URL", type: "string", required: false, description: "Cloud Convex URL" },
  { name: "CLOUD_CONVEX_DEPLOY_KEY", type: "string", required: false, description: "Cloud deploy key" },
]} />

### Graph Database Configuration

<APITable parameters={[
  { name: "NEO4J_URI", type: "string", required: false, description: "Neo4j connection URI" },
  { name: "NEO4J_USERNAME", type: "string", required: false, description: "Neo4j username" },
  { name: "NEO4J_PASSWORD", type: "string", required: false, description: "Neo4j password" },
  { name: "MEMGRAPH_URI", type: "string", required: false, description: "Memgraph connection URI" },
  { name: "MEMGRAPH_USERNAME", type: "string", required: false, description: "Memgraph username" },
  { name: "MEMGRAPH_PASSWORD", type: "string", required: false, description: "Memgraph password" },
  { name: "CORTEX_GRAPH_SYNC", type: "string", required: false, description: "Enable graph sync ('true'/'false')" },
]} />

### Other Configuration

<APITable parameters={[
  { name: "OPENAI_API_KEY", type: "string", required: false, description: "OpenAI API key for embeddings" },
  { name: "CORTEX_SDK_DEV_PATH", type: "string", required: false, description: "Path to local SDK for dev mode" },
  { name: "DEBUG", type: "string", required: false, description: "Enable debug output" },
]} />

### Example .env.local

<Tabs>
  <TabItem value="development" label="Development">

```env
# Convex Configuration
CONVEX_URL=http://127.0.0.1:3210

# Optional: Graph Database
NEO4J_URI=bolt://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=password

# Optional: Embeddings
OPENAI_API_KEY=sk-your-key-here
```

<Callout type="tip">
  Use `cortex dev` for hot-reload development.
</Callout>

  </TabItem>
  <TabItem value="staging" label="Staging">

```env
# Convex Configuration
CONVEX_URL=https://your-staging-app.convex.cloud
CONVEX_DEPLOY_KEY=dev:your-staging-app|key

# Optional: Graph Database
NEO4J_URI=bolt://staging-neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=staging-password

# Optional: Embeddings
OPENAI_API_KEY=sk-your-key-here
```

  </TabItem>
  <TabItem value="production" label="Production">

```env
# Convex Configuration
CONVEX_URL=https://your-prod-app.convex.cloud
CONVEX_DEPLOY_KEY=prod:your-prod-app|key

# Optional: Graph Database
NEO4J_URI=bolt://prod-neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=secure-production-password

# Optional: Embeddings
OPENAI_API_KEY=sk-your-key-here
```

<Callout type="warning">
  Never commit production credentials to version control!
</Callout>

  </TabItem>
</Tabs>

---

## Multi-Environment Setup

### Example: Local + Staging + Production

<Steps>
  <Step title="Add local development">

```bash
cortex config add-deployment local \
  --url http://127.0.0.1:3210

cortex config set-path local ~/projects/my-agent
```

  </Step>
  <Step title="Add staging">

```bash
cortex config add-deployment staging \
  --url https://staging.convex.cloud

cortex config set-key staging  # Prompts for key
```

  </Step>
  <Step title="Add production">

```bash
cortex config add-deployment production \
  --url https://prod.convex.cloud

cortex config set-key production  # Prompts for key
```

  </Step>
  <Step title="Enable only local for auto-start">

```bash
cortex config enable local
cortex config disable staging
cortex config disable production

# Now 'cortex start' starts only local
# Use 'cortex start -d staging' for staging
# Use 'cortex start -d production' for production
```

  </Step>
</Steps>

### Switching Between Environments

```bash
# Work on local
cortex use local
cortex start
cortex db stats

# Switch to production
cortex use production
cortex db stats           # Shows production stats
cortex memory list --space user-123

# Or target specific deployment without switching
cortex db stats -d staging
```

---

## Project Configuration (Optional)

### cortex.config.json

You can optionally create a `cortex.config.json` in your project root:

```json
{
  "defaultMemorySpace": "my-agent",
  "defaultImportance": 50,
  "memoryRetention": {
    "maxVersions": 10,
    "retentionDays": 365
  },
  "graph": {
    "enabled": true,
    "uri": "bolt://localhost:7687"
  }
}
```

<Callout type="note">
  This is optional. Most configuration is managed via CLI in `~/.cortexrc`.
</Callout>

---

## SDK Configuration

When using the SDK programmatically, configuration is minimal:

```typescript
import { Cortex } from "@cortexmemory/sdk";

// Minimal configuration
const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!, // Set by CLI or .env.local
});
```

### With Graph Database

```typescript
import {
  CypherGraphAdapter,
  initializeGraphSchema,
} from "@cortexmemory/sdk/graph";

const graphAdapter = new CypherGraphAdapter();
await graphAdapter.connect({
  uri: process.env.NEO4J_URI!,
  username: process.env.NEO4J_USERNAME!,
  password: process.env.NEO4J_PASSWORD!,
});

await initializeGraphSchema(graphAdapter);

const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
  graph: {
    adapter: graphAdapter,
    orphanCleanup: true,
  },
});
```

**See:**

- [API Reference - Memory Operations](/api-reference/memory-operations)
- [Graph Database Integration](/advanced-topics/graph-database-integration)

---

## Authentication Configuration

<Tabs>
  <TabItem value="clerk" label="Clerk">

```typescript
import { Cortex, createAuthContext } from "@cortexmemory/sdk";
import { auth } from "@clerk/nextjs";

const { userId } = auth();

const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
  auth: createAuthContext({
    userId,
    authMethod: "clerk",
  }),
});
```

  </TabItem>
  <TabItem value="auth0" label="Auth0">

```typescript
import { Cortex, createAuthContext } from "@cortexmemory/sdk";

const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
  auth: createAuthContext({
    userId: session.user.sub,
    authMethod: "auth0",
  }),
});
```

  </TabItem>
  <TabItem value="nextauth" label="NextAuth">

```typescript
import { Cortex, createAuthContext } from "@cortexmemory/sdk";
import { getServerSession } from "next-auth";

const session = await getServerSession();

const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
  auth: createAuthContext({
    userId: session?.user?.id,
    authMethod: "nextauth",
  }),
});
```

  </TabItem>
  <TabItem value="custom" label="Custom JWT">

```typescript
const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
  auth: createAuthContext({
    userId: decodedToken.sub,
    tenantId: decodedToken.org_id,
    authMethod: "custom-jwt",
  }),
});
```

  </TabItem>
</Tabs>

---

## Common CLI Workflows

### Workflow 1: Multi-Environment Development

```bash
# Morning: Start local development
cortex use local
cortex dev  # Interactive dashboard

# Afternoon: Test on staging
cortex use staging
cortex start
cortex db stats  # Check staging data

# Evening: Deploy to production
cortex use production
cortex deploy
cortex status  # Verify deployment
```

### Workflow 2: Database Management

```bash
# Backup production before changes
cortex use production
cortex db backup --output prod-backup-$(date +%Y%m%d).json

# Make changes on staging
cortex use staging
cortex db clear  # Clear test data
# ... make changes ...

# Verify changes worked
cortex db stats

# Deploy to production
cortex use production
cortex deploy
```

### Workflow 3: GDPR Compliance

```bash
# Export user data (GDPR portability)
cortex users export user-123 --output user-data.json

# Preview deletion (dry run)
cortex users delete user-123 --cascade --dry-run

# Delete user data (GDPR erasure)
cortex users delete user-123 --cascade --verify
```

---

## Security Configuration

### Data Isolation

Ensure proper memory space boundaries:

```bash
# Good: User-specific space
cortex memory list --space user-alice
cortex memory list --space user-bob

# Bad: Shared space (unless intentional)
cortex memory list --space global
```

### Sensitive Data

<Callout type="warning" title="PII Handling">
  Be careful with personally identifiable information (PII).
</Callout>

```bash
# Search for potential PII
cortex memory search "password" --space user-123
cortex memory search "email" --space user-123

# Export for review
cortex memory export --space user-123 --output review.json

# Delete if needed
cortex memory delete <memoryId> --space user-123
```

---

## Performance Configuration

### Connection Reuse

The CLI reuses connections automatically. For SDK usage:

```typescript
// Good: Single instance (recommended)
const cortex = new Cortex({ convexUrl: process.env.CONVEX_URL! });

// Use this instance throughout your app
export default cortex;

// Bad: Creating new instance for each operation
// This creates unnecessary connections
```

### Batch Operations

Use CLI commands efficiently:

```bash
# Export all spaces at once
cortex spaces list --format json > spaces.json

# Export memories for multiple spaces
for space in $(cat spaces.json | jq -r '.[].id'); do
  cortex memory export --space $space --output "$space-memories.json"
done
```

---

## Advanced Configuration

### Debug Mode

Enable verbose logging:

```bash
# Via flag
cortex db stats --debug

# Via environment variable
DEBUG=1 cortex db stats

# Shows:
# - Environment variable loading
# - Configuration resolution
# - API request/response details
# - Process spawning
```

### Custom Output Formats

```bash
# Table format (default)
cortex db stats

# JSON format (for scripting)
cortex db stats --format json

# CSV format (for export)
cortex memory list --space user-123 --format csv
```

### Configuration Reset

<Callout type="danger" title="Destructive Action">
  This removes all deployments and apps but keeps project .env.local files and deployed Convex data.
</Callout>

<Terminal>cortex config reset</Terminal>

---

## Configuration Best Practices

### 1. Use Environment Variables

```typescript
// Good: Environment-based config
const cortex = new Cortex({
  convexUrl: process.env.CONVEX_URL!,
});

// Bad: Hardcoded values
const cortex = new Cortex({
  convexUrl: "https://my-deployment.convex.cloud", // Don't!
});
```

### 2. Separate Environments

```bash
# Development
cortex use local

# Staging
cortex use staging

# Production
cortex use production

# Never mix!
```

### 3. Secure Credentials

```bash
# Store deploy keys securely
cortex config set-key production  # Prompts for key

# Never commit keys to git
echo ".env.local" >> .gitignore
```

### 4. Test Before Production

```bash
# Always test on staging first
cortex use staging
cortex deploy
cortex db stats
# ... verify everything works ...

# Then deploy to production
cortex use production
cortex deploy
```

### 5. Regular Backups

```bash
# Backup production regularly
cortex use production
cortex db backup --output prod-backup-$(date +%Y%m%d).json

# Automate with cron
0 2 * * * cd /path/to/project && cortex use production && cortex db backup
```

---

## Troubleshooting

### Configuration Not Found

```bash
# Error: No deployments configured

# Fix: Initialize a project
cortex init

# Or add existing deployment
cortex config add-deployment
```

### Wrong Deployment

```bash
# Check current deployment
cortex use

# Switch to correct one
cortex use local

# Or clear and specify
cortex use --clear
cortex db stats -d local
```

### Connection Failed

```bash
# Test connection
cortex config test

# Check URL
cortex config show

# Verify Convex is running
cortex status
cortex start
```

### Environment Variable Conflicts

```bash
# Check what's being used
cortex config show --debug

# Priority order:
# 1. CLI flags (--url, --key)
# 2. Environment variables
# 3. User config (~/.cortexrc)
```

---

## Next Steps

<QuickNav>
  <QuickNavItem 
    title="Auth Integration" 
    description="Set up authentication providers" 
    href="/getting-started/auth-integration" 
  />
  <QuickNavItem 
    title="Memory Operations" 
    description="Start using the SDK API" 
    href="/api-reference/memory-operations" 
  />
  <QuickNavItem 
    title="CLI Reference" 
    description="All CLI commands documented" 
    href="/tools/cli-reference" 
  />
  <QuickNavItem 
    title="System Architecture" 
    description="Understand how Cortex works" 
    href="/architecture/system-overview" 
  />
</QuickNav>
