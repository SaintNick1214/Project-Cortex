# Strict ESLint Configuration for Project Cortex

## Overview

Project Cortex uses a **strict ESLint configuration** based on ESLint 9 flat config format with TypeScript ESLint v8. This configuration enforces high code quality standards, type safety, and consistent coding practices.

## Configuration File

- **File**: `eslint.config.js`
- **Format**: ESLint 9 Flat Config (modern format)
- **TypeScript Support**: Full type-aware linting with `@typescript-eslint` v8

## Key Features

### 1. Strict TypeScript Rules

The configuration enforces:

- **Explicit return types** on all functions and methods
- **Explicit member accessibility** (public/private/protected)
- **Strict type checking** with type-aware rules
- **No implicit `any`** types
- **Strict boolean expressions** (no truthy/falsy shortcuts)
- **Consistent type imports** (using `import type`)
- **No unsafe operations** on `any` types
- **Promise handling** (all promises must be awaited or handled)

### 2. Code Quality Rules

- **Complexity limits**: Max cyclomatic complexity of 15
- **Function size limits**: Max 100 lines per function
- **File size limits**: Max 500 lines per file
- **Statement limits**: Max 30 statements per function
- **Nesting limits**: Max 4 levels of nesting, 3 nested callbacks
- **Parameter limits**: Max 5 parameters per function

### 3. Best Practices

- **No `any` types** - Must use `unknown` instead
- **No `console.log`** - Only `console.warn` and `console.error` allowed
- **Strict equality** - Must use `===` and `!==`
- **No magic numbers** - Named constants required (except -1, 0, 1, 2)
- **No `var`** - Must use `const` or `let`
- **Prefer `const`** - Variables that don't change must use `const`
- **Arrow functions** preferred for callbacks
- **Template literals** preferred over string concatenation
- **No parameter reassignment** - Function parameters are immutable
- **No implicit coercion** - Explicit type conversions required

### 4. Naming Conventions

- **camelCase** for variables, functions, and methods
- **PascalCase** for classes, interfaces, types, and enums
- **UPPER_CASE** for constants
- **Private members** must have leading underscore (`_`)
- **No "I" prefix** for interfaces (modern TypeScript convention)

### 5. Code Style

- **Consistent imports** - Sorted by type (none, all, multiple, single)
- **Member ordering** - Specific order for class members
- **Spacing** - Consistent blank lines between statements
- **Comments** - Must have space after `//` or `/*`
- **Unicode regex** - All regex must have `u` flag

## File-Specific Configurations

### Convex Files (`convex-dev/**/*.ts`, `convex/**/*.ts`)

Relaxed rules for Convex schema and function files:
- No explicit return types required
- No explicit module boundary types required
- Magic numbers allowed

### Test Files (`**/*.test.ts`, `**/*.spec.ts`, `tests/**/*.ts`)

Relaxed rules for testing:
- `any` types allowed (warnings only)
- Unsafe operations allowed (warnings only)
- No line/statement limits
- No function naming requirements
- `console` statements allowed

### Script Files (`scripts/**/*.ts`, `scripts/**/*.js`)

Relaxed rules for scripts:
- `console` statements allowed
- Unsafe operations allowed (warnings)
- `any` types allowed (warnings)
- No line/statement limits

### Configuration Files (`*.config.*`)

Minimal restrictions:
- Naming conventions relaxed
- `console` statements allowed
- Magic numbers allowed
- `require` imports allowed

## Ignore Patterns

The following are automatically excluded from linting:

- `node_modules/`
- `dist/`
- `_generated/`
- `coverage/`
- `.convex/`
- `build/`, `.next/`, `out/`
- `*.min.js`, `*.bundle.js`
- `.cache/`, `.parcel-cache/`
- Test output files
- Log files

## Running ESLint

### Lint all files
```bash
npm run lint
```

### Lint specific file
```bash
npx eslint path/to/file.ts
```

### Auto-fix issues
```bash
npx eslint path/to/file.ts --fix
```

### Lint with type checking
The configuration automatically performs type checking using your `tsconfig.json`.

## Common Issues and Solutions

### Issue: "Member must have leading underscore"

**Cause**: Private class members must start with `_`

**Solution**: Rename private members:
```typescript
// ❌ Bad
private client: ConvexHttpClient;

// ✅ Good
private _client: ConvexHttpClient;
```

### Issue: "Missing accessibility modifier"

**Cause**: All class members must have explicit `public`, `private`, or `protected`

**Solution**: Add accessibility modifiers:
```typescript
// ❌ Bad
constructor(client: ConvexHttpClient) {}

// ✅ Good
public constructor(client: ConvexHttpClient) {}
```

### Issue: "Promises must be awaited"

**Cause**: All promises must be handled

**Solution**: Use `await`, `.catch()`, or `void`:
```typescript
// ❌ Bad
someAsyncFunction();

// ✅ Good - await
await someAsyncFunction();

// ✅ Good - catch
someAsyncFunction().catch(console.error);

// ✅ Good - void (intentional fire-and-forget)
void someAsyncFunction();
```

### Issue: "Async method has no 'await' expression"

**Cause**: Async functions must use `await`

**Solution**: Either add `await` or remove `async`:
```typescript
// ❌ Bad
public async close(): Promise<void> {
  this._client.close();
}

// ✅ Good - remove async
public close(): void {
  this._client.close();
}

// ✅ Good - add await
public async close(): Promise<void> {
  await this._client.closeAsync();
}
```

### Issue: "Use `export type` for type-only exports"

**Cause**: Type-only exports should use `export type`

**Solution**: Change to type export:
```typescript
// ❌ Bad
export { MyType };

// ✅ Good
export type { MyType };
```

## Disabling Rules (Use Sparingly)

### Disable for a single line
```typescript
// eslint-disable-next-line @typescript-eslint/no-explicit-any
const value: any = something;
```

### Disable for a block
```typescript
/* eslint-disable @typescript-eslint/no-magic-numbers */
const HTTP_OK = 200;
const HTTP_NOT_FOUND = 404;
/* eslint-enable @typescript-eslint/no-magic-numbers */
```

### Disable for entire file (avoid!)
```typescript
/* eslint-disable @typescript-eslint/explicit-function-return-type */
```

## Philosophy

This strict configuration is designed to:

1. **Catch bugs early** - Many rules prevent common TypeScript pitfalls
2. **Enforce consistency** - Code looks the same across the entire project
3. **Improve maintainability** - Explicit types and clear code structure
4. **Promote best practices** - Modern TypeScript and JavaScript patterns
5. **Enhance type safety** - Leverage TypeScript's type system fully

## Compatibility

- **ESLint**: 9.38.0+
- **TypeScript ESLint**: 8.46.2+
- **TypeScript**: 5.9.3+
- **Node**: 16+

## References

- [ESLint Flat Config Documentation](https://eslint.org/docs/latest/use/configure/configuration-files)
- [TypeScript ESLint Rules](https://typescript-eslint.io/rules/)
- [TypeScript ESLint v8 Migration Guide](https://typescript-eslint.io/blog/announcing-typescript-eslint-v8)

## Maintenance

The ESLint configuration is maintained as part of Project Cortex. When upgrading ESLint or TypeScript ESLint, review the changelog for deprecated or new rules and update `eslint.config.js` accordingly.

